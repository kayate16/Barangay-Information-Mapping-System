{% extends "base.html" %}

{% block title %}Dashboard - {{ super() }}{% endblock %}

{% block extra_css %}
<style>
    .dashboard-page {
        padding: 2rem 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: calc(100vh - 120px);
    }

    .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .dashboard-header h1 {
        color: var(--primary);
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .dashboard-header p {
        color: var(--gray);
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .stat-card {
        background: white;
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-left: 4px solid var(--primary);
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .stat-card.large {
        grid-column: span 1;
    }

    .stat-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.8;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 1.1rem;
        color: var(--gray);
        font-weight: 500;
    }

    .charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .chart-card {
        background: white;
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .chart-card h3 {
        color: var(--primary);
        margin-bottom: 1.5rem;
        font-size: 1.3rem;
        font-weight: 600;
    }

    .chart-placeholder {
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .simple-chart {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .chart-bar {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .bar-label {
        min-width: 120px;
        font-weight: 500;
        color: var(--dark);
    }

    .bar-container {
        flex: 1;
        background: #f1f5f9;
        border-radius: 10px;
        overflow: hidden;
        height: 30px;
    }

    .bar-fill {
        background: linear-gradient(90deg, var(--secondary), var(--primary));
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
        transition: width 1s ease;
    }

    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .action-btn {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.2rem;
        background: var(--light);
        border: 2px dashed #cbd5e1;
        border-radius: var(--border-radius);
        text-decoration: none;
        color: var(--dark);
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
        transform: translateX(5px);
    }

    .action-icon {
        font-size: 1.5rem;
        width: 40px;
        text-align: center;
    }

    .action-text {
        font-weight: 500;
        flex: 1;
    }

    .recent-activity {
        background: white;
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .recent-activity h3 {
        color: var(--primary);
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
        font-weight: 600;
    }

    .info-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .info-card {
        background: var(--light);
        padding: 1.5rem;
        border-radius: var(--border-radius);
        border-left: 4px solid var(--secondary);
    }

    .info-card h4 {
        color: var(--primary);
        margin-bottom: 1rem;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .info-card ul {
        list-style: none;
        padding: 0;
    }

    .info-card li {
        padding: 0.5rem 0;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
    }

    .info-card li:before {
        content: "‚úì";
        color: var(--success);
        font-weight: bold;
        margin-right: 0.5rem;
    }

    .info-card li:last-child {
        border-bottom: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .charts-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .dashboard-header h1 {
            font-size: 2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-page">
    <div class="container">
        <div class="dashboard-header">
            <h1>Barangay Cagpile Dashboard</h1>
            <p>Comprehensive overview of barangay statistics and community insights</p>
        </div>

        <!-- Statistics Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üè†</div>
                <div class="stat-number">{{ stats.total_households }}</div>
                <div class="stat-label">Total Households</div>
                <small>Registered in system</small>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-number">{{ stats.total_residents }}</div>
                <div class="stat-label">Total Residents</div>
                <small>Approximate population</small>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üè¢</div>
                <div class="stat-number">{{ stats.total_facilities }}</div>
                <div class="stat-label">Community Facilities</div>
                <small>Schools, chapels, etc.</small>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üõ°Ô∏è</div>
                <div class="stat-number">{{ stats.vulnerable_households }}</div>
                <div class="stat-label">Vulnerable Households</div>
                <small>With seniors/PWDs</small>
            </div>
        </div>

        <!-- Charts and Actions -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìä Community Distribution</h3>
                <div class="chart-placeholder">
                    <div class="simple-chart">
                        <div class="chart-bar">
                            <div class="bar-label">Vulnerable Households</div>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: {{ (stats.vulnerable_households / stats.total_households * 100) if stats.total_households > 0 else 0 }}%">
                                    {{ stats.vulnerable_households }} ({{ "%.1f"|format((stats.vulnerable_households / stats.total_households * 100) if stats.total_households > 0 else 0) }}%)
                                </div>
                            </div>
                        </div>
                        <div class="chart-bar">
                            <div class="bar-label">Regular Households</div>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: {{ ((stats.total_households - stats.vulnerable_households) / stats.total_households * 100) if stats.total_households > 0 else 0 }}%; background: linear-gradient(90deg, #10b981, #059669);">
                                    {{ stats.total_households - stats.vulnerable_households }} ({{ "%.1f"|format(((stats.total_households - stats.vulnerable_households) / stats.total_households * 100) if stats.total_households > 0 else 0) }}%)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Purok Distribution -->
                    <div style="margin-top: 2rem;">
                        <h4 style="color: var(--primary); margin-bottom: 1rem;">Purok Distribution</h4>
                        <div class="simple-chart">
                            {% for purok, count in stats.purok_distribution.items() %}
                            <div class="chart-bar">
                                <div class="bar-label">Purok {{ purok }}</div>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: {{ (count / stats.total_households * 100) if stats.total_households > 0 else 0 }}%; background: linear-gradient(90deg, #f59e0b, #d97706);">
                                        {{ count }} ({{ "%.1f"|format((count / stats.total_households * 100) if stats.total_households > 0 else 0) }}%)
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="chart-card">
                <h3>üöÄ Quick Actions</h3>
                <div class="action-buttons">
                    <a href="{{ url_for('map_view') }}" class="action-btn">
                        <span class="action-icon">üó∫Ô∏è</span>
                        <span class="action-text">Explore Interactive Map</span>
                    </a>
                    <a href="{{ url_for('household_data') }}" class="action-btn">
                        <span class="action-icon">üìã</span>
                        <span class="action-text">Manage Household Data</span>
                    </a>
                    <a href="{{ url_for('map_editor') }}" class="action-btn">
                        <span class="action-icon">‚úèÔ∏è</span>
                        <span class="action-text">Open GIS Editor</span>
                    </a>
                    <button class="action-btn" onclick="exportData()">
                        <span class="action-icon">üìä</span>
                        <span class="action-text">Generate Reports</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="recent-activity">
            <h3>üèóÔ∏è System Overview</h3>
            <div class="info-cards">
                <div class="info-card">
                    <h4>Technology Stack</h4>
                    <ul>
                        <li>Backend: Flask Python Framework</li>
                        <li>Frontend: HTML5, CSS3, JavaScript</li>
                        <li>Mapping: Leaflet.js with QGIS Integration</li>
                        <li>Data Format: GeoJSON Standard</li>
                        <li>Styling: Custom CSS3 with Variables</li>
                    </ul>
                </div>
                <div class="info-card">
                    <h4>Data Features</h4>
                    <ul>
                        <li>Real-time Statistics & Analytics</li>
                        <li>Interactive Map Visualization</li>
                        <li>Household Management System</li>
                        <li>Vulnerability Assessment</li>
                        <li>GIS Editing Capabilities</li>
                    </ul>
                </div>
                <div class="info-card">
                    <h4>Community Insights</h4>
                    <ul>
                        <li>{{ stats.total_households }} Households Mapped</li>
                        <li>{{ stats.total_facilities }} Facilities Documented</li>
                        <li>{{ stats.vulnerable_households }} Vulnerable Households</li>
                        <li>{{ stats.purok_distribution|length }} Puroks Covered</li>
                        <li>Disaster Risk Assessment Ready</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function exportData() {
    // Simple export functionality
    const data = {
        households: {{ stats.total_households }},
        residents: {{ stats.total_residents }},
        facilities: {{ stats.total_facilities }},
        vulnerable: {{ stats.vulnerable_households }},
        timestamp: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `barangay-cagpile-stats-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Show success message
    alert('Statistics exported successfully!');
}

// Animate numbers on page load
document.addEventListener('DOMContentLoaded', function() {
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(stat => {
        const finalValue = parseInt(stat.textContent);
        let currentValue = 0;
        const duration = 2000;
        const increment = finalValue / (duration / 16);
        
        const timer = setInterval(() => {
            currentValue += increment;
            if (currentValue >= finalValue) {
                stat.textContent = finalValue.toLocaleString();
                clearInterval(timer);
            } else {
                stat.textContent = Math.floor(currentValue).toLocaleString();
            }
        }, 16);
    });
});
</script>
{% endblock %}